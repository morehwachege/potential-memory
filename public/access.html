<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Document</title>
</head>

<body>
    <main>
        <nav>
            <div class="navbar">
                <h2 class="logo"><a href="#">Fine <span>Editor</span></a></h2>
            </div>
            <div class="navbar">
                <li class="nav"><a href="docs.html">Docs</a></li>
                <li class="nav"><a href="#">Instructions</a></li>
            </div>
        </nav>
        <div class="dome">
            <h2 class="hero">Speak to your microphone to transcribe</h2>
           <center>
               <div class="entry">
                <p id="transcripted-text"></p>
                <script src="https://cdn.ckeditor.com/4.9.1/standard/ckeditor.js"></script>
              <!-- <h1>{{title}}</h1> -->
               <textarea name="editor1" class="transcripted-text" >
                   <!-- <p id="transcripted-text"></p> --> this should be amazing
               </textarea>
                 <script>
                     CKEDITOR.replace( 'editor1' );
                 </script>
             </div>



           </center>
        </div>
        <footer>
            <h4>&copy; Muriithi Gakuru</h4>
        </footer>
    </main>
    
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <script>
        let moreh = document.getElementById('transcripted-text')
        const commands ={
            paragraph:'</br>'
        }
        
       navigator.mediaDevices.getUserMedia({ audio:true}).then((stream) =>{
           // console.log(stream);
           const mediaRecorder = new MediaRecorder(stream, {mimeType: 'audio/webm'})
           const socket = new WebSocket('wss://api.deepgram.com/v1/listen', ['token', 'cdb248936f67417eb85e2372c6a26d8637b2561b'])

           socket.onopen = () =>{
               mediaRecorder.addEventListener('dataavailable', event =>{
                   socket.send(event.data)
               })
               mediaRecorder.start(1000)
           }
           socket.onmessage = (message) =>{
               const received = JSON.parse(message.data)
               const transcript = received.channel.alternatives[0].transcript
               console.log(transcript)
               moreh.innerHTML += transcript + ' '
               //if (transcript == 'paragraph'){
                //transcript = commands['paragraph']
                //}
               
               // document.write(transcript)
           }
       })
    </script>
</body>

</html>